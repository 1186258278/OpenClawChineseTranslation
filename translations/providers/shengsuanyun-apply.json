{
  "file": "src/commands/auth-choice.apply.api-providers.ts",
  "description": "胜算云认证流程 - 处理 shengsuanyun-api-key 认证选项（含默认模型与 provider 配置）",
  "replacements": {
    "  applyXiaomiProviderConfig,\n  applyZaiConfig,": "  applyXiaomiProviderConfig,\n  applyShengsuanyunConfig,\n  applyShengsuanyunProviderConfig,\n  applyZaiConfig,",
    "  XIAOMI_DEFAULT_MODEL_REF,\n  ZAI_DEFAULT_MODEL_REF,": "  XIAOMI_DEFAULT_MODEL_REF,\n  SHENGSUANYUN_DEFAULT_MODEL_REF,\n  ZAI_DEFAULT_MODEL_REF,",
    "setTogetherApiKey,": "setShengSuanYunApiKey,\n  setTogetherApiKey,",
    "if (authChoice === \"together-api-key\") {": "if (authChoice === \"shengsuanyun-api-key\") {\n    const store = ensureAuthProfileStore(params.agentDir, { allowKeychainPrompt: false });\n    const profileOrder = resolveAuthProfileOrder({\n      cfg: nextConfig,\n      store,\n      provider: \"shengsuanyun\",\n    });\n    const existingProfileId = profileOrder.find((profileId) => Boolean(store.profiles[profileId]));\n    const existingCred = existingProfileId ? store.profiles[existingProfileId] : undefined;\n    let profileId = \"shengsuanyun:default\";\n    let mode: \"api_key\" | \"token\" = \"api_key\";\n    let hasCredential = false;\n\n    if (existingProfileId && existingCred?.type) {\n      profileId = existingProfileId;\n      mode = existingCred.type === \"token\" ? \"token\" : \"api_key\";\n      hasCredential = true;\n    }\n\n    if (!hasCredential && params.opts?.token && params.opts?.tokenProvider === \"shengsuanyun\") {\n      await setShengSuanYunApiKey(normalizeApiKeyInput(params.opts.token), params.agentDir);\n      hasCredential = true;\n    }\n\n    if (!hasCredential) {\n      await params.prompter.note(\n        [\n          \"胜算云是国内 API 聚合平台，支持多种 AI 模型。\",\n          \"获取 API 密钥: https://console.shengsuanyun.com/user/keys\",\n          \"新用户注册可获赠体验金（限时活动，详情以官网为准）\",\n        ].join(\"\\n\"),\n        \"胜算云\",\n      );\n    }\n\n    if (!hasCredential) {\n      const envKey = resolveEnvApiKey(\"shengsuanyun\");\n      if (envKey) {\n        const useExisting = await params.prompter.confirm({\n          message: `使用现有的 SHENGSUANYUN_API_KEY (${envKey.source}, ${formatApiKeyPreview(envKey.apiKey)})?`,\n          initialValue: true,\n        });\n        if (useExisting) {\n          await setShengSuanYunApiKey(envKey.apiKey, params.agentDir);\n          hasCredential = true;\n        }\n      }\n    }\n\n    if (!hasCredential) {\n      const key = await params.prompter.text({\n        message: \"输入胜算云 API 密钥\",\n        validate: validateApiKeyInput,\n      });\n      await setShengSuanYunApiKey(normalizeApiKeyInput(String(key)), params.agentDir);\n      hasCredential = true;\n    }\n\n    if (hasCredential) {\n      nextConfig = applyAuthProfileConfig(nextConfig, {\n        profileId,\n        provider: \"shengsuanyun\",\n        mode,\n      });\n    }\n\n    const applied = await applyDefaultModelChoice({\n      config: nextConfig,\n      setDefaultModel: params.setDefaultModel,\n      defaultModel: SHENGSUANYUN_DEFAULT_MODEL_REF,\n      applyDefaultConfig: applyShengsuanyunConfig,\n      applyProviderConfig: applyShengsuanyunProviderConfig,\n      noteDefault: SHENGSUANYUN_DEFAULT_MODEL_REF,\n      noteAgentModel,\n      prompter: params.prompter,\n    });\n    agentModelOverride = applied.agentModelOverride ?? agentModelOverride;\n    return { config: applied.config, agentModelOverride };\n  }\n\n  if (authChoice === \"together-api-key\") {"
  }
}
